<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Program Staffing Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        
        /* Transitions */
        .program-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .program-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        #modal-backdrop { transition: opacity 0.3s ease; }
        #modal-panel { transition: all 0.3s ease; }

        /* Calendar specific styles */
        .calendar-grid {
            grid-template-columns: repeat(7, minmax(0, 1fr));
        }
        .calendar-program-entry:hover {
            filter: brightness(1.1);
        }
        .view-toggle-active {
            background-color: #4f46e5;
            color: white;
        }
        .pl-event-entry {
            font-size: 0.65rem;
            padding: 2px 4px;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <header class="mb-6 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Program Staffing Dashboard</h1>
            <p class="mt-2 text-md text-gray-600">Filter programs and assign staff for 2026.</p>
        </header>

        <div class="mb-6 max-w-2xl mx-auto">
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                </div>
                <input type="text" id="country-search" placeholder="Search by country (e.g., Fiji, Japan)..." class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg bg-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-indigo-500 sm:text-sm shadow-sm">
            </div>
        </div>
        
        <div id="view-toggle" class="flex justify-center mb-6 space-x-2">
            <button id="card-view-btn" class="px-4 py-2 text-sm font-medium rounded-md view-toggle-active">Card View</button>
            <button id="calendar-view-btn" class="px-4 py-2 text-sm font-medium rounded-md">Calendar View</button>
            <button id="list-view-btn" class="px-4 py-2 text-sm font-medium rounded-md">Staffing List</button>
        </div>

        <div id="user-info" class="text-center mb-4 text-xs text-gray-500">Connecting to Google Sheet...</div>

        <div id="views-container">
            <div id="card-view" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            
            <div id="calendar-view" class="hidden bg-white rounded-lg shadow-lg p-4">
                <div id="calendar-header" class="flex items-center justify-between mb-4">
                    <button id="prev-month" class="p-2 rounded-full hover:bg-gray-100">&lt;</button>
                    <h2 id="month-year" class="text-xl font-bold"></h2>
                    <button id="next-month" class="p-2 rounded-full hover:bg-gray-100">&gt;</button>
                </div>
                <div id="calendar-weekdays" class="calendar-grid grid gap-px text-center text-xs font-semibold text-gray-500 mb-2">
                    <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                </div>
                <div id="calendar-grid" class="calendar-grid grid gap-px"></div>
            </div>
            
            <div id="list-view" class="hidden bg-white rounded-lg shadow-lg p-4 overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PL Work Dates</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Program</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Staffing Summary (From Sheet)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recruitment Stage</th>
                        </tr>
                    </thead>
                    <tbody id="staffing-list-body" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
        </div>
        
        <div id="no-results" class="hidden text-center py-16">
             <h3 class="text-lg font-medium text-gray-700">No programs found</h3>
             <p class="text-sm text-gray-500">Try a different country or clear the search.</p>
        </div>
    </div>

    <div id="modal-backdrop" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden z-40"></div>
    <div id="modal" class="fixed inset-0 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div id="modal-panel" class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10">
                            <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title"></h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500" id="modal-group-size"></p>
                                <div id="modal-staffing-needs" class="mt-4 space-y-4"></div>
                                <button id="add-pl-button" class="mt-4 text-sm text-indigo-600 hover:text-indigo-800 font-medium">+ Add Program Leader</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="save-button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">Save</button>
                    <button type="button" id="close-modal-button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm">Cancel</button>
                </div>
                 <div id="save-status" class="px-6 pb-2 text-sm text-center text-green-600"></div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- CONFIGURATION ---
        const WEB_APP_URL = "https://script.google.com/a/macros/rusticpathways.com/s/AKfycbxD3G6BP8hVGxAeD-0UUYfuqRarF472SOqgw988RB9Ba3kGzkZ196CHyAjkB-mW7V6w/exec";

        // --- STATE ---
        let currentView = 'card';
        let currentDate = new Date('2026-01-01T12:00:00Z');
        const minDate = new Date('2026-01-01T12:00:00Z');
        const maxDate = new Date('2026-12-31T12:00:00Z');
        let liveProgramData = [];
        let currentProgramId = null;

        // --- GOOGLE SHEET DATA INTERACTION ---
        async function loadDataFromSheet() {
            const userInfo = document.getElementById('user-info');
            userInfo.textContent = 'Loading data from Google Sheet...';
            userInfo.style.color = ''; 
            
            try {
                const response = await fetch(WEB_APP_URL);
                if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                const data = await response.json();
                if (data.error) throw new Error(`Apps Script Error: ${data.error}`);
                
                liveProgramData = data;
                userInfo.textContent = `Connected to Google Sheet. Loaded ${liveProgramData.length} programs.`;
                render();
            } catch (error) {
                console.error("Error fetching data from Google Sheet:", error);
                userInfo.textContent = `Connection failed: ${error.message}`;
                userInfo.style.color = 'red';
            }
        }

        async function handleSave(programId, dataToUpdate) {
            const saveStatus = document.getElementById('save-status');
            if(saveStatus) saveStatus.textContent = 'Saving...';
            
            const payload = {
                id: programId,
                data: dataToUpdate
            };

            try {
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    body: JSON.stringify(payload),
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                    }
                });

                if (saveStatus && !ui.modal.classList.contains('hidden')) {
                    saveStatus.textContent = 'Saved successfully!';
                    await loadDataFromSheet(); 
                    setTimeout(closeModal, 1000);
                } else {
                    await loadDataFromSheet();
                }
                
            } catch (error) {
                console.error("Error posting data:", error);
                if(saveStatus) saveStatus.textContent = `Error saving data.`;
            }
        }

        // --- UI ELEMENTS & COLOR LOGIC ---
        const ui = {
            searchInput: document.getElementById('country-search'),
            noResults: document.getElementById('no-results'),
            modal: document.getElementById('modal'),
            modalBackdrop: document.getElementById('modal-backdrop'),
            closeModalButton: document.getElementById('close-modal-button'),
            saveButton: document.getElementById('save-button'),
            addPlButton: document.getElementById('add-pl-button'),
            viewButtons: { card: document.getElementById('card-view-btn'), calendar: document.getElementById('calendar-view-btn'), list: document.getElementById('list-view-btn') },
            views: { card: document.getElementById('card-view'), calendar: document.getElementById('calendar-view'), list: document.getElementById('list-view') }
        };
        
        const countryColorCache = {};
        const colorPalette = ['#4f46e5', '#db2777', '#16a34a', '#d97706', '#0891b2', '#6d28d9', '#be185d', '#059669', '#ca8a04', '#c026d3', '#4338ca', '#b91c1c'];
        function getColorForCountry(country) {
            if (!country) return '#6b7280';
            if (countryColorCache[country]) return countryColorCache[country];
            let hash = 0;
            for (let i = 0; i < country.length; i++) { hash = country.charCodeAt(i) + ((hash << 5) - hash); }
            const color = colorPalette[Math.abs(hash % colorPalette.length)];
            countryColorCache[country] = color;
            return color;
        }

        // --- MASTER RENDER FUNCTION ---
        function render() {
            const searchTerm = ui.searchInput.value.toLowerCase();
            let filteredPrograms = liveProgramData.filter(p => p.country && p.country.toLowerCase().includes(searchTerm));
            ui.noResults.classList.toggle('hidden', filteredPrograms.length > 0 || currentView === 'list');
            
            if (currentView === 'card') {
                filteredPrograms.sort((a, b) => new Date(a.inCountryStartDate) - new Date(b.inCountryStartDate));
                renderCardView(filteredPrograms);
            }
            else if (currentView === 'calendar') renderCalendar(filteredPrograms);
            else if (currentView === 'list') renderListView();
        }

        // --- VIEW RENDERERS ---
        function renderCardView(programsToRender) {
            ui.views.card.innerHTML = '';
            programsToRender.forEach(program => {
                const card = document.createElement('div');
                card.className = 'program-card bg-white rounded-lg shadow-md overflow-hidden cursor-pointer';
                const formattedStartDate = new Date(program.inCountryStartDate).toLocaleDateString('en-US', { timeZone: 'UTC', month: 'short', day: 'numeric' });
                const formattedEndDate = new Date(program.inCountryEndDate).toLocaleDateString('en-US', { timeZone: 'UTC', month: 'short', day: 'numeric', year: 'numeric' });
                
                const stageColor = program.stage === 'Booked' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';

                card.innerHTML = `
                    <div class="p-5 border-l-4 relative" style="border-color: ${getColorForCountry(program.country)}">
                        <div class="absolute top-3 right-3 px-2 py-1 text-xs font-medium rounded-full ${stageColor}">${program.stage}</div>
                        <p class="text-sm font-semibold" style="color: ${getColorForCountry(program.country)}">${program.country ? program.country.toUpperCase() : 'NO COUNTRY'}</p>
                        <h3 class="mt-1 text-xl font-bold text-gray-900 truncate pr-20">${program.name}</h3>
                        <p class="mt-2 text-sm text-gray-500">${formattedStartDate} - ${formattedEndDate}</p>
                    </div>`;
                card.addEventListener('click', () => openModal(program.id));
                ui.views.card.appendChild(card);
            });
        }

        function renderCalendar(programsToRender) {
            const month = currentDate.getUTCMonth();
            const year = currentDate.getUTCFullYear();
            document.getElementById('month-year').textContent = `${currentDate.toLocaleString('default', { timeZone: 'UTC', month: 'long' })} ${year}`;
            const calendarGrid = document.getElementById('calendar-grid');
            calendarGrid.innerHTML = '';
            const firstDay = new Date(Date.UTC(year, month, 1)).getUTCDay();
            const daysInMonth = new Date(Date.UTC(year, month + 1, 0)).getUTCDate();
            for (let i = 0; i < firstDay; i++) { calendarGrid.innerHTML += `<div class="bg-gray-50"></div>`; }
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'relative border border-gray-200 h-28 p-1';
                dayCell.innerHTML = `<span class="text-xs font-semibold">${day}</span><div class="space-y-1 mt-1 overflow-y-auto max-h-20"></div>`;
                calendarGrid.appendChild(dayCell);
            }
            programsToRender.forEach(program => {
                const dates = {
                    arrival: new Date(program.plArrivalDate + 'T00:00:00Z'),
                    start: new Date(program.inCountryStartDate + 'T00:00:00Z'),
                    end: new Date(program.inCountryEndDate + 'T00:00:00Z'),
                    depart: new Date(program.plDepartDate + 'T00:00:00Z')
                };
                for (let day = 1; day <= daysInMonth; day++) {
                    const currentCellDate = new Date(Date.UTC(year, month, day));
                    const cell = calendarGrid.children[firstDay + day - 1];
                    if (!cell) continue;
                    
                    const countryColor = getColorForCountry(program.country);

                    if (currentCellDate >= dates.arrival && currentCellDate < dates.start) {
                        const entry = document.createElement('div');
                        entry.className = 'pl-event-entry text-white rounded truncate';
                        if (currentCellDate.getTime() === dates.arrival.getTime()) {
                            entry.textContent = 'PL Arrival Day';
                        } else {
                            entry.textContent = 'PL Training Days';
                        }
                        entry.style.backgroundColor = countryColor;
                        entry.style.opacity = '0.6';
                        cell.querySelector('div').appendChild(entry);
                    }
                    if (currentCellDate >= dates.start && currentCellDate <= dates.end) {
                        const entry = document.createElement('div');
                        entry.className = 'calendar-program-entry text-white text-xs p-1 rounded cursor-pointer truncate';
                        entry.style.backgroundColor = countryColor;
                        entry.textContent = program.name;
                        entry.addEventListener('click', () => openModal(program.id));
                        cell.querySelector('div').appendChild(entry);
                    }
                    if (currentCellDate > dates.end && currentCellDate <= dates.depart) {
                        const entry = document.createElement('div');
                        entry.className = 'pl-event-entry text-white rounded truncate';
                        if (currentCellDate.getTime() === dates.depart.getTime()) {
                            entry.textContent = 'PL Depart';
                        } else {
                            entry.textContent = 'PL Wrap-up';
                        }
                        entry.style.backgroundColor = countryColor;
                        entry.style.opacity = '0.6';
                        cell.querySelector('div').appendChild(entry);
                    }
                }
            });
        }

        function renderListView() {
            const programsWithSummary = liveProgramData.filter(p => p.staffingSummary);
            programsWithSummary.sort((a, b) => new Date(a.plArrivalDate) - new Date(b.plArrivalDate));
            
            const listBody = document.getElementById('staffing-list-body');
            listBody.innerHTML = '';
            if (programsWithSummary.length === 0) {
                listBody.innerHTML = `<tr><td colspan="5" class="text-center py-10 text-gray-500">No programs with staffing assignments found in the sheet.</td></tr>`;
            } else {
                programsWithSummary.forEach(program => {
                    const row = document.createElement('tr');
                    
                    // THIS IS THE LINE WITH THE FIX. A backtick ` was added at the end.
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            <input type="date" class="list-date-select border-gray-300 rounded-md shadow-sm" data-program-id="${program.id}" data-date-type="plArrivalDate" value="${program.plArrivalDate}">
                            -
                            <input type="date" class="list-date-select border-gray-300 rounded-md shadow-sm" data-program-id="${program.id}" data-date-type="plDepartDate" value="${program.plDepartDate}">
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${program.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${program.staffingSummary}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 italic">N/A</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 italic">Not supported</td>`;
                    listBody.appendChild(row);
                });
            }
        }
        
        // --- DYNAMIC STAFFING UI & MODAL ---
        function createStaffingRow(staff = { name: '', type: 'INTL', recruitmentStage: 'Possible' }) {
            const div = document.createElement('div');
            div.className = 'grid grid-cols-3 gap-2 items-center staff-row';
            
            const stageOptions = ["Possible", "Verbal Agreement", "Jazz Ready", "Offer Out", "Offer Signed"]
                .map(opt => `<option value="${opt}" ${staff.recruitmentStage === opt ? 'selected' : ''}>${opt}</option>`).join('');

            div.innerHTML = `
                <div class="col-span-3"><input type="text" class="pl-name shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="PL Name (not saved)" value="${staff.name || ''}"></div>
                <div><select class="pl-type shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                    <option value="INTL" ${staff.type === 'INTL' ? 'selected' : ''}>INTL</option>
                    <option value="Local" ${staff.type === 'Local' ? 'selected' : ''}>Local</option>
                    <option value="RPAlien" ${staff.type === 'RPAlien' ? 'selected' : ''}>RPAlien</option>
                </select></div>
                <div><select class="pl-stage shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" disabled>${stageOptions}</select></div>
                <div class="flex justify-end"><button type="button" class="delete-pl-button text-red-500 hover:text-red-700 p-1 rounded-full text-xl font-bold">&times;</button></div>`;
            div.querySelector('.delete-pl-button').addEventListener('click', () => {
                div.remove();
                updatePlCount();
            });
            return div;
        }

        function updatePlCount() {
            if (!currentProgramId) return;
            const program = liveProgramData.find(p => p.id === currentProgramId);
            if (!program) return;

            const assignedCount = document.querySelectorAll('#modal-staffing-needs .staff-row').length;
            const groupSizeEl = document.getElementById('modal-group-size');
            groupSizeEl.textContent = `${program.students} students, ${program.chaperones} chaperones | Staffing: ${assignedCount} / Needed: ${program.plNeeded}`;
        }

        function openModal(programId) {
            currentProgramId = programId;
            const program = liveProgramData.find(p => p.id === programId);
            if (!program) return;
            document.getElementById('modal-title').textContent = program.name;
            document.getElementById('modal-group-size').textContent = `${program.students} students, ${program.chaperones} chaperones`;
            document.getElementById('save-status').textContent = '';
            
            const staffingNeedsDiv = document.getElementById('modal-staffing-needs');
            staffingNeedsDiv.innerHTML = ''; 
            
            const needed = program.plNeeded || 1;
            for(let i=0; i < needed; i++) {
                staffingNeedsDiv.appendChild(createStaffingRow());
            }

            ui.modal.classList.remove('hidden');
            ui.modalBackdrop.classList.remove('hidden');
            updatePlCount();
        }

        function closeModal() {
            ui.modal.classList.add('hidden');
            ui.modalBackdrop.classList.add('hidden');
            currentProgramId = null;
        }

        // --- EVENT LISTENERS ---
        ui.searchInput.addEventListener('keyup', render);
        ui.closeModalButton.addEventListener('click', closeModal);
        ui.modalBackdrop.addEventListener('click', closeModal);
        
        ui.saveButton.addEventListener('click', () => {
            if (!currentProgramId) return;
            
            const staffingRows = document.querySelectorAll('#modal-staffing-needs .staff-row');
            const staffingData = Array.from(staffingRows).map(row => ({
                name: row.querySelector('.pl-name').value.trim(),
                type: row.querySelector('.pl-type').value,
                recruitmentStage: 'Possible' 
            }));
            
            const dataToUpdate = {
                staffing: staffingData
            };
            
            handleSave(currentProgramId, dataToUpdate);
        });
        
        ui.addPlButton.addEventListener('click', () => {
              document.getElementById('modal-staffing-needs').appendChild(createStaffingRow());
              updatePlCount();
        });
        
        ui.views.list.addEventListener('change', async (event) => {
            const target = event.target;
            const programId = target.dataset.programId;
            if (!programId || !target.classList.contains('list-date-select')) return;

            const program = liveProgramData.find(p => p.id === programId);
            if (!program) return;

            const dateType = target.dataset.dateType;
            const newDate = target.value;
            
            await handleSave(programId, { [dateType]: newDate });
        });
        
        Object.keys(ui.viewButtons).forEach(viewName => {
            ui.viewButtons[viewName].addEventListener('click', () => {
                currentView = viewName;
                Object.keys(ui.views).forEach(v => ui.views[v].classList.toggle('hidden', v !== viewName));
                Object.keys(ui.viewButtons).forEach(b => ui.viewButtons[b].classList.toggle('view-toggle-active', b === viewName));
                render();
            });
        });

        document.getElementById('prev-month').addEventListener('click', () => {
            currentDate.setUTCMonth(currentDate.getUTCMonth() - 1);
            if (currentDate < minDate) currentDate = new Date(minDate);
            render();
        });
        document.getElementById('next-month').addEventListener('click', () => {
            currentDate.setUTCMonth(currentDate.getUTCMonth() + 1);
            if (currentDate > maxDate) currentDate = new Date(maxDate);
            render();
        });
        
        // --- INITIALIZATION ---
        loadDataFromSheet();
    });
    </script>
</body>
</html>